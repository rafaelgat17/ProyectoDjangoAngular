<div class="circuit-container" *ngIf="circuitData">
  <svg [attr.width]="svgWidth" [attr.height]="svgHeight" class="circuit-svg">
    
    <!-- ===== CAPA 1: LÍNEAS DE CONEXIÓN (fondo) ===== -->
    <g class="connections">
      <ng-container *ngFor="let comp of componentes">
        <ng-container *ngIf="getNode(comp.source) as sourceNode">
          <ng-container *ngIf="getNode(comp.target) as targetNode">
            <line
              [attr.x1]="getNodeX(sourceNode.col)"
              [attr.y1]="getNodeY(sourceNode.row)"
              [attr.x2]="getNodeX(targetNode.col)"
              [attr.y2]="getNodeY(targetNode.row)"
              [attr.stroke]="getComponentColor(comp.type)"
              stroke-width="4"
              stroke-linecap="round"
              opacity="0.3"/>
          </ng-container>
        </ng-container>
      </ng-container>
    </g>
    
    <!-- ===== CAPA 2: COMPONENTES (medio) ===== -->
    <g class="components">
      <ng-container *ngFor="let comp of componentes">
        <ng-container *ngIf="comp.type !== 'opencircuit'">
          <!-- Círculo con el símbolo del componente -->
          <circle
            [attr.cx]="getComponentMidPoint(comp).x"
            [attr.cy]="getComponentMidPoint(comp).y"
            r="30"
            [attr.fill]="getComponentColor(comp.type)"
            stroke="black"
            stroke-width="3"
            class="component-circle"/>
          
          <!-- Símbolo del componente (letra) -->
          <text
            [attr.x]="getComponentMidPoint(comp).x"
            [attr.y]="getComponentMidPoint(comp).y"
            text-anchor="middle"
            dominant-baseline="middle"
            class="component-symbol">
            {{ getComponentSymbol(comp.type) }}
          </text>
        </ng-container>
      </ng-container>
    </g>
    
    <!-- ===== CAPA 3: ETIQUETAS DE VALORES ===== -->
    <g class="labels">
      <ng-container *ngFor="let comp of componentes">
        <ng-container *ngIf="comp.value">
          <!-- Fondo de la etiqueta -->
          <rect
            [attr.x]="getLabelPosition(comp).x - 50"
            [attr.y]="getLabelPosition(comp).y - 16"
            width="100"
            height="32"
            fill="white"
            stroke="#F39C12"
            stroke-width="2"
            rx="6"
            class="label-bg"/>
          
          <!-- Texto del valor -->
          <text
            [attr.x]="getLabelPosition(comp).x"
            [attr.y]="getLabelPosition(comp).y"
            text-anchor="middle"
            dominant-baseline="middle"
            class="label-text">
            {{ comp.value }}
          </text>
        </ng-container>
      </ng-container>
    </g>
    
    <!-- ===== CAPA 4: NODOS (encima de todo) ===== -->
    <g class="nodes">
      <ng-container *ngFor="let nodo of nodos">
        <!-- Círculo del nodo -->
        <circle
          [attr.cx]="getNodeX(nodo.col)"
          [attr.cy]="getNodeY(nodo.row)"
          [attr.r]="NODE_RADIUS"
          fill="#2C3E50"
          stroke="black"
          stroke-width="2"
          class="node-circle"/>
        
        <!-- Etiqueta del nodo (N00, N01, etc.) -->
        <text
          [attr.x]="getNodeX(nodo.col)"
          [attr.y]="getNodeY(nodo.row)"
          text-anchor="middle"
          dominant-baseline="middle"
          class="node-label">
          {{ nodo.id }}
        </text>
      </ng-container>
    </g>
    
  </svg>
</div>

<!-- Mensaje si no hay datos -->
<div *ngIf="!circuitData" class="no-data">
  <p>No hay datos del circuito para mostrar</p>
</div>